<div class="profile-container">
  <button class="back-btn" routerLink="/main/feed">‚Üê –ù–∞–∑–∞–¥</button>

  <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è...</p>
  </div>

  <div *ngIf="!isLoading && user" class="profile-content">
    <!-- Header —Å –∞–≤–∞—Ç–∞—Ä–æ–º -->
    <div class="profile-header">
      <div class="avatar-wrapper">
        <img [src]="user.avatar" alt="avatar" class="profile-avatar">

      </div>
      <div class="profile-info-header">
        <h1 class="profile-username">{{ user.username }}</h1>
        <button
          *ngIf="!isOwnProfile()"
          class="follow-btn"
          (click)="toggleFollow()"
          [disabled]="isFollowLoading"
          [class.following]="isFollowing"
        >
          {{ isFollowing ? '‚úì –ü–æ–¥–ø–∏—Å–∫–∏' : '+ –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è' }}
        </button>
        <button *ngIf="isOwnProfile()"
                (click)="onOpenEditModal()"
                class="edit-btn">
          –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        </button>

      </div>
    </div>

    <div class="profile-stats">
      <div class="stat-item">
        <span class="stat-number">{{ postsCount }}</span>
        <span class="stat-label">–ü–æ—Å—Ç–æ–≤</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{ followersCount }}</span>
        <span class="stat-label">–ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{ followingCount }}</span>
        <span class="stat-label">–ü–æ–¥–ø–∏—Å–æ–∫</span>
      </div>
    </div>

    <div class="profile-info">
      <div class="info-item">
        <span class="info-icon">üìß</span>
        <span class="info-text">{{ user.email }}</span>
      </div>
      <div class="info-item" *ngIf="user.bio">
        <span class="info-icon">üìù</span>
        <span class="info-text">{{ user.bio }}</span>
      </div>
    </div>

    <!-- –ü–æ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-posts-section" *ngIf="userPosts.length > 0">
      <h2 class="posts-section-title">–ü–æ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
      <div class="posts-grid">
        <div
          class="post-thumbnail"
          *ngFor="let post of userPosts; trackBy: trackByPostId"
        >
          <img [src]="post.image" [alt]="post.description">
          <div class="post-overlay">
            <span class="post-likes">‚ù§Ô∏è {{ post.likesCount || 0 }}</span>
            <span class="post-comments">üí¨ {{ post.commentsCount || 0 }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="no-posts" *ngIf="!isLoading && userPosts.length === 0">
      <p>–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤</p>
    </div>
  </div>

  <div *ngIf="!isLoading && !user" class="error-state">
    <p>‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω</p>
  </div>


  <div *ngIf="showEditModal" class="edit-modal-overlay" (click)="onCloseEditModal()">
    <div class="edit-modal-content" (click)="$event.stopPropagation()">
      <div class="edit-modal-header">
        <h2 class="edit-modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h2>
        <button class="edit-modal-close" (click)="onCloseEditModal()">√ó</button>
      </div>

      <div class="edit-modal-body">
        <div class="edit-form-group edit-form-group-avatar">
          <label class="edit-form-label">–ê–≤–∞—Ç–∞—Ä</label>
          <input
            type="file"
            id="avatar-input"
            accept="image/*"
            (change)="handlerFileInput($event)"
            class="edit-form-file-input"
          />
          <div *ngIf="editAvatar" class="edit-avatar-preview">
            <img [src]="editAvatar" alt="–ü—Ä–µ–≤—å—é" />
          </div>
          <label for="avatar-input" class="edit-form-avatar-btn">
            –ò–∑–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
          </label>
        </div>

        <div class="edit-form-group">
          <label class="edit-form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
          <input
            type="text"
            class="edit-form-input"
            [(ngModel)]="editUsername"
            placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è"
          />
        </div>

        <div class="edit-form-group">
          <label class="edit-form-label">–û —Å–µ–±–µ</label>
          <textarea
            class="edit-form-textarea"
            [(ngModel)]="editBio"
            placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ"
            rows="4"
          ></textarea>
        </div>
      </div>

      <div class="edit-modal-footer">
        <button type="button" class="edit-btn-cancel" (click)="onCloseEditModal()">
          –û—Ç–º–µ–Ω–∞
        </button>
        <button type="button" class="edit-btn-save" (click)="onSaveProfile()">
          –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
        </button>
      </div>
    </div>
  </div>
</div>
